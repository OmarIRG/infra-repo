apiVersion: apps/v1
kind: Deployment
metadata:
  name: app
  labels:
    app: app                     # Ù„ÙŠØ¨Ù„ Ø±Ø¦ÙŠØ³Ù‰ Ø¨Ø³ÙŠØ·
spec:
  replicas: 1
  selector:
    matchLabels:
      app: app
  template:
    metadata:
      labels:
        app: app
    spec:
      # ğŸ”‘ 1) Ø³Ø±Ù‘ Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† ECR
      imagePullSecrets:
        - name: ecr-creds        # Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† secret Ø¬Ø§Ù‡Ø² Ø¨Ø§Ù„Ø§Ø³Ù… Ø¯Ù‡

      containers:
        - name: app
          # ğŸ”‘ 2) Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ø§ØµØ© ÙÙ‰ ECR
          image: 484614878230.dkr.ecr.us-east-1.amazonaws.com/todo-nodejs-app:latest
          
          # ğŸ”‘ 3) Ù…ØªØºÙŠÙ‘Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø­ØªØ§Ø¬Ù‡Ø§
          env:
            - name: mongoDbUrl
              value: mongodb://mongo:27017/todo?authSource=admin   # Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø¨Ø§Ø³ÙˆØ±Ø¯

          ports:
            - containerPort: 4000

          # (Ø§Ø®ØªÙŠØ§Ø±Ù‰) ÙØ­Øµ Ø§Ù„Ø­Ø§ÙˆÙŠØ© ÙƒÙ„ 30â€¯Ø«Ø§Ù†ÙŠØ©
          livenessProbe:
            exec:
              command: ["wget", "-qO-", "http://localhost:4000/health"]
            initialDelaySeconds: 10
            periodSeconds: 30
            timeoutSeconds: 5

      restartPolicy: Always
