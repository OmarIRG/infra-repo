apiVersion: apps/v1
kind: Deployment
metadata:
  name: app
  labels:
    app: app                     # ليبل رئيسى بسيط
spec:
  replicas: 1
  selector:
    matchLabels:
      app: app
  template:
    metadata:
      labels:
        app: app
    spec:
      # 🔑 1) سرّ السحب من ECR
      imagePullSecrets:
        - name: ecr-creds        # لازم يكون secret جاهز بالاسم ده

      containers:
        - name: app
          # 🔑 2) الصورة الخاصة فى ECR
          image: 484614878230.dkr.ecr.us-east-1.amazonaws.com/todo-nodejs-app:latest
          
          # 🔑 3) متغيّرات البيئة اللى التطبيق محتاجها
          env:
            - name: mongoDbUrl
              value: mongodb://mongo:27017/todo?authSource=admin   # عدّلها لو عندك باسورد

          ports:
            - containerPort: 4000

          # (اختيارى) فحص الحاوية كل 30 ثانية
          livenessProbe:
            exec:
              command: ["wget", "-qO-", "http://localhost:4000/health"]
            initialDelaySeconds: 10
            periodSeconds: 30
            timeoutSeconds: 5

      restartPolicy: Always
